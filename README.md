# Tá Liso — Web App

Frontend for the Tá Liso personal finance app. Allows users to organize spending by category, register expenses in natural language via chat, and track their monthly budget and summary.

## Stack

| Layer | Technology |
|-------|-----------|
| Framework | Vue 3 (Composition API) |
| Build | Vite 7 |
| Language | TypeScript |
| Styling | Tailwind CSS v4 |
| Routing | Vue Router v5 |
| Global state | Pinia |
| Data fetching | TanStack Query v5 |
| HTTP client | Axios |
| Hook generation | Orval (from the API's OpenAPI spec) |
| Tests | Vitest + Vue Test Utils |

## Features

- **Passwordless login:** email → 6-digit code → JWT stored in `localStorage`
- **Home:** monthly balance, low-balance category alerts, per-category progress and recent transactions
- **Categories:** full CRUD with icon, budget and progress bar
- **Chat:** natural-language expense registration; desktop view includes a category balance sidebar
- **Summary:** month selector, metric cards, per-category breakdown and transaction list
- **Settings:** profile, notification/reset/blocking toggles and logout
- **Responsive:** mobile bottom navigation bar, desktop sidebar + topbar

## Screens

| Route | Description |
|-------|-------------|
| `/login` | Email input |
| `/token` | 6-digit code received by email |
| `/` | Home: monthly balance, alerts and categories |
| `/categorias` | New category form and category list with budget |
| `/chat` | Assistant for registering expenses in natural language |
| `/resumo` | Month selector, balance, per-category spending and transactions |
| `/configuracoes` | Profile, settings and sign out |

## Code structure

```
src/
├── api/
│   └── generated/       # hooks and types generated by Orval (do not edit manually)
├── assets/              # global CSS (Tailwind)
├── components/          # AppShell, BottomNav, DesktopSidebar, DesktopTopbar, ChatMessage...
├── composables/         # all API logic encapsulated (useHome, useChat, useCategoriesManagement...)
├── helpers/             # utility functions
├── router/              # routes + auth guard + scroll reset
├── services/
│   └── api.ts           # axios instance with JWT and 401 interceptors
├── stores/              # Pinia stores
├── utils/               # formatting utilities
├── views/               # one view per route (import composables only, never raw hooks)
└── main.ts
```

### Composables pattern

Views **never** import Orval-generated hooks directly. All API logic lives in composables under `src/composables/`:

| Composable | View | Responsibility |
|-----------|------|----------------|
| `useHome` | HomeView | categories, total balance, low-balance alerts, month label |
| `useChat` | ChatView | message history, send message, low-balance toasts, auto-scroll; on transaction response invalidates and refetches categories + transactions so sidebar and other views stay in sync |
| `useCategoriesManagement` | CategoriesView | list, create and delete categories |
| `useMonthlyResume` | ResumoView | selected month data, month navigation |
| `useConfiguracoes` | ConfiguracoesView | profile, name form, settings toggles |
| `useAuth` | — | logout (clears localStorage + TanStack Query cache) |
| `useUser` | — | authenticated user data, avatar initials |
| `useSettings` | — | user settings (shared cache) |
| `useApiError` | — | extracts error messages from Axios responses |

## Prerequisites

- Node.js `^20.19.0` or `>=22.12.0`

## Local setup

### 1. Install dependencies

```bash
npm install
```

### 2. Environment variables

Create a `.env.local` file at the project root:

```env
VITE_API_URL=http://localhost:8000
VITE_API_KEY=your-api-key-here
```

To point at production:

```env
VITE_API_URL=https://ta-liso-app.online
VITE_API_KEY=your-api-key-here
```

### 3. Start development server

```bash
npm run dev
```

App available at `http://localhost:5173`.

## Scripts

| Command | Description |
|---------|-------------|
| `npm run dev` | Development server with hot-reload |
| `npm run build` | Production build (output in `dist/`) |
| `npm run preview` | Preview the production build locally |
| `npm run test:unit` | Run tests with Vitest |
| `npm run lint` | Lint with oxlint + ESLint (auto-fix) |
| `npm run format` | Format with Prettier |
| `npm run type-check` | Type-check with vue-tsc |
| `npm run gen:api` | Regenerate hooks and types from the API's OpenAPI spec |

## Hook generation (Orval)

Orval reads the API's `openapi.json` and generates TanStack Query hooks + TypeScript types in `src/api/generated/`. Run this whenever the backend changes:

```bash
npm run gen:api
```

Configuration lives in `orval.config.ts`. The base HTTP client (`src/services/api.ts`) automatically injects `X-API-Key` and the JWT into every request, and redirects to `/login` on any `401` response.

### Cache invalidation (TanStack Query)

When the user registers an expense via the chat and the API returns a `transaction`, the frontend:

1. Pushes the bot reply (with the transaction) into the message list.
2. Invalidates and **refetches** the **categories** and **transactions** queries so that the chat sidebar, Home, and Resumo views show updated balances immediately without a manual refresh.
3. Invalidates the **chat history** query so the next load includes the new message.

This is implemented in `useChat` (`src/composables/useChat.ts`). Creating or deleting categories in `useCategoriesManagement` also invalidates the categories query.

## Deployment

The frontend is hosted as a static site on **S3 + CloudFront** (AWS). Build locally and sync to the bucket:

```bash
npm run build
aws s3 sync dist/ s3://taliso-frontend --delete
```

See `docs/ta-liso-INFRA.md` for the full deployment guide.

## IDE

- **VS Code:** install the [Vue - Official](https://marketplace.visualstudio.com/items?itemName=Vue.volar) extension (disable Vetur if installed)
- **Browser:** [Vue DevTools](https://devtools.vuejs.org/) for inspecting components and state
